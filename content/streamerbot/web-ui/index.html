<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook Embed Builder with User Interface ‚Ä¢ [WEB‚Ä¢UI]</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <a href="https://sorylokan.github.io/?p=content/streamerbot/extensions/webhook-embed-builder" class="back-button" title="Return to Extension Page">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                    </svg>
                    <span>Retour</span>
                </a>
                <div class="header-separator"></div>
                <div class="logo">
                    <img src="WEBWUI_Icon.svg" alt="Logo">
                    <span>Webhook Embed Builder</span>
                </div>
            </div>
            <div class="header-actions header-connection">
                <input id="wsAddress" class="header-input" type="text" placeholder="ws host" value="localhost">
                <input id="wsPort" class="header-input" type="number" placeholder="port" value="8080">
                <div class="connection-status">
                    <span id="wsStatus" class="status-dot offline"></span>
                    <span id="wsStatusText">Disconnected</span>
                </div>
                <button id="connectBtn" class="btn btn-primary btn-sm">Connect</button>
            </div>
            <div id="notification" class="notification hidden"></div>
        </header>

        <div class="main-container">
            <!-- Left Panel: Form with Tabs -->
            <aside class="left-panel">
                <!-- Tab Navigation -->
                <div class="tabs">
                    <button class="tab-btn active" data-tab="info">‚öôÔ∏è Informations</button>
                    <button class="tab-btn" data-tab="content">üé® Content</button>
                </div>

                <!-- Tab Content -->
                <div class="tabs-content">
                    <!-- Informations Tab -->
                    <div class="tab-content active" id="info" data-content="info">
                        <div class="tab-section">
                            <div class="form-group">
                                <label for="webhookUrl">Discord Webhook URL</label>
                                <div class="webhook-url-row">
                                    <input type="text" id="webhookUrl" placeholder="(Optional) https://discord.com/api/webhooks/..." class="webhook-url-input">
                                    <button id="testWebhookBtn" class="btn btn-secondary webhook-test-btn" disabled title="Enter a Discord Webhook URL to test">Test Webhook</button>
                                </div>
                                <div class="webhook-notes">
                                    <small class="webhook-url-note">If the URL is not specified, you can define it directly in Streamer.bot using an argument.<br/> ‚Ä¢ Default argument: <code>WEBWUI_WebhookURL</code></small>
                                    <small class="webhook-test-note">Note: StreamerBot arguments and variables <i>(%arguments% or ~Global Variable~)</i> do not work with the "TEST WEBHOOK" button. <br/> You must first save the payload in StreamerBot, and then, send it from a send action.</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="webhookUsername">Webhook Username</label>
                                <input type="text" id="webhookUsername" placeholder="(Optional) Webhook Name" maxlength="80">
                            </div>
                            <div class="form-group">
                                <label for="webhookAvatarUrl">Webhook Avatar URL</label>
                                <input type="text" id="webhookAvatarUrl" placeholder="(Optional) https://...">
                            </div>
                            <div class="divider"></div>
                            <div class="form-group">
                                <small style="color: var(--primary); display: block; margin-bottom: 12px; font-size: 12px; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px;">‚öôÔ∏è Streamer.bot Parameters</small>
                                <label for="globalVarName">Global Variable Name</label>
                                <input type="text" id="globalVarName" placeholder="WEBWUI_WebhookPayload" >
                            </div>
                            <div class="button-group">
                                <div class="button-row">
                                    <button id="loadVarBtn" class="btn btn-secondary">Load Config</button>
                                </div>
                                <div class="divider"></div>
                                <button id="clearBtn" class="btn btn-outline btn-danger save-text btn-full">Clear</button>
                            </div>
                        </div>
                    </div>

                    <!-- Content Tab -->
                    <div class="tab-content" id="content" data-content="content">
                        <div class="tab-section">
                            <div class="form-group">
                                <label for="msgContent">Message Content</label>
                                <textarea id="msgContent" placeholder="Your message text..." rows="6" maxlength="2000"></textarea>
                            </div>
                            <div class="divider"></div>
                            <button id="addEmbedBtn" class="btn btn-secondary btn-full">+ Add Embed</button>
                            <div id="embedsContainer" class="embeds-container"></div>
                        </div>
                    </div>
                </div>

                <!-- Main Action Button -->
                <div class="save-section">
                    <button id="saveToStreamerBtn" class="btn btn-primary btn-large save-text btn-full">
                        Save to StreamerBot
                    </button>
                </div>
            </aside>

            <!-- Right Panel: Preview -->
            <main class="right-panel">
                <div class="preview-header">
                    <h2>Discord Preview</h2>
                </div>

                <div class="preview-container">
                    <div id="previewMessage" class="discord-message">
                        <div class="preview-placeholder">Your message will appear here</div>
                    </div>
                </div>

                <!-- JSON Viewer -->
                <div class="json-section">
                    <div class="json-header">
                        <h3>JSON Payload</h3>
                        <button id="jsonCollapseBtn" class="btn btn-outline btn-sm">‚ñº</button>
                    </div>
                    <div id="jsonContent" class="json-content">
                        <div class="json-viewer">
                            <pre id="jsonViewer">{}</pre>
                        </div>
                        <div class="json-actions">
                            <button id="exportJsonBtn" class="btn btn-outline">üì§ Export</button>
                            <button id="copyJsonBtn" class="btn btn-outline">üìã Copy JSON</button>
                            <button id="importJsonBtn" class="btn btn-outline">üì• Import</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Clear Confirmation Modal -->
        <div id="clearModal" class="modal hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚ö†Ô∏è Clear All Data</h2>
                    <button class="modal-close" onclick="document.getElementById('clearModal').classList.add('hidden')">&times;</button>
                </div>
                <div class="modal-body">
                    <p style="line-height: 1.6; margin: 0;">
                        This action will <strong>permanently delete</strong> all text fields in the configuration:
                    </p>
                    <ul style="margin: 12px 0; padding-left: 20px;">
                        <li>Message content</li>
                        <li>Webhook URL, username, avatar</li>
                        <li>All embeds and fields</li>
                        <li>Global variable name</li>
                    </ul>
                    <p style="color: #f04747; font-weight: 600; margin: 12px 0 0 0;">
                        ‚ö†Ô∏è There is <strong>no way to undo</strong> this action!
                    </p>
                </div>
                <div class="modal-footer">
                    <button id="clearConfirmBtn" class="btn btn-danger">Yes, Delete Everything</button>
                    <button id="clearCancelBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Import Modal -->
        <div id="importModal" class="modal hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Import JSON Configuration</h2>
                    <button class="modal-close" onclick="document.getElementById('importModal').classList.add('hidden')">&times;</button>
                </div>
                <textarea id="jsonImportArea" placeholder="Paste your JSON configuration here..." rows="12"></textarea>
                <div class="modal-footer">
                    <button id="importConfirmBtn" class="btn btn-primary">Import</button>
                    <button id="importCancelBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Load Configuration Confirmation Modal -->
        <div id="loadConfigModal" class="modal hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚ö†Ô∏è Load Configuration</h2>
                    <button class="modal-close" onclick="document.getElementById('loadConfigModal').classList.add('hidden')">&times;</button>
                </div>
                <div class="modal-body">
                    <p style="line-height: 1.6; margin: 0;">
                        Loading a configuration will <strong>replace your current work</strong>:
                    </p>
                    <ul style="margin: 12px 0; padding-left: 20px;">
                        <li>All message content</li>
                        <li>All webhook settings</li>
                        <li>All embeds and fields</li>
                    </ul>
                    <p style="color: #f04747; font-weight: 600; margin: 12px 0 0 0;">
                        ‚ö†Ô∏è Any unsaved changes will be <strong>permanently lost</strong>!
                    </p>
                </div>
                <div class="modal-footer">
                    <button id="loadConfigConfirmBtn" class="btn btn-danger">Yes, Load Configuration</button>
                    <button id="loadConfigCancelBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Import Configuration Confirmation Modal -->
        <div id="importConfigModal" class="modal hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚ö†Ô∏è Import Configuration</h2>
                    <button class="modal-close" onclick="document.getElementById('importConfigModal').classList.add('hidden')">&times;</button>
                </div>
                <div class="modal-body">
                    <p style="line-height: 1.6; margin: 0;">
                        Importing a configuration will <strong>replace your current work</strong>:
                    </p>
                    <ul style="margin: 12px 0; padding-left: 20px;">
                        <li>All message content</li>
                        <li>All webhook settings</li>
                        <li>All embeds and fields</li>
                    </ul>
                    <p style="color: #f04747; font-weight: 600; margin: 12px 0 0 0;">
                        ‚ö†Ô∏è Any unsaved changes will be <strong>permanently lost</strong>!
                    </p>
                </div>
                <div class="modal-footer">
                    <button id="importConfigConfirmBtn" class="btn btn-danger">Yes, Import Configuration</button>
                    <button id="importConfigCancelBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Remove Embed Confirmation Modal -->
        <div id="removeEmbedModal" class="modal hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚ö†Ô∏è Remove Embed</h2>
                    <button class="modal-close" onclick="document.getElementById('removeEmbedModal').classList.add('hidden')">&times;</button>
                </div>
                <div class="modal-body">
                    <p style="line-height: 1.6; margin: 0;">
                        This will <strong>permanently delete</strong> this embed and all its content:
                    </p>
                    <ul style="margin: 12px 0; padding-left: 20px;">
                        <li>Title, description, and URL</li>
                        <li>Author information</li>
                        <li>All fields</li>
                        <li>Images and thumbnails</li>
                        <li>Footer and timestamp</li>
                    </ul>
                    <p style="color: #f04747; font-weight: 600; margin: 12px 0 0 0;">
                        ‚ö†Ô∏è This action <strong>cannot be undone</strong>!
                    </p>
                </div>
                <div class="modal-footer">
                    <button id="removeEmbedConfirmBtn" class="btn btn-danger">Yes, Remove Embed</button>
                    <button id="removeEmbedCancelBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Remove Field Confirmation Modal -->
        <div id="removeFieldModal" class="modal hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚ö†Ô∏è Remove Field</h2>
                    <button class="modal-close" onclick="document.getElementById('removeFieldModal').classList.add('hidden')">&times;</button>
                </div>
                <div class="modal-body">
                    <p style="line-height: 1.6; margin: 0;">
                        This will <strong>permanently delete</strong> this field and its content.
                    </p>
                    <p style="color: #f04747; font-weight: 600; margin: 12px 0 0 0;">
                        ‚ö†Ô∏è This action <strong>cannot be undone</strong>!
                    </p>
                </div>
                <div class="modal-footer">
                    <button id="removeFieldConfirmBtn" class="btn btn-danger">Yes, Remove Field</button>
                    <button id="removeFieldCancelBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>StreamerBot extension | Webhook Embed Builder with User Interface ‚Ä¢ [WEB‚Ä¢UI] v1 ‚Ä¢ by Sorylokan ‚Ä¢ <a href="https://ko-fi.com/sorylokan" class="external-link kofi-link">
                <svg width="16" height="16" viewBox="0 0 48 48" fill="none" class="kofi-icon">
                    <circle cx="24" cy="24" r="20" fill="#1196cc"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M32.531 16H15.262c-.697 0-1.262.565-1.262 1.262v11.643a2.524 2.524 0 0 0 2.524 2.524h11.918a2.524 2.524 0 0 0 2.523-2.524v-1.646h1.566A5.47 5.47 0 0 0 38 21.79v-.321A5.47 5.47 0 0 0 32.531 16m-1.565 8.34v-5.421h1.427a2.71 2.71 0 1 1 0 5.42zm-6.051-4.911q-2.187 0-2.772 1.71-.585-1.71-2.772-1.71c-2.187 0-2.998 2.72-1.852 4.5q1.147 1.779 4.624 4.5 3.478-2.721 4.623-4.5c1.147-1.78.336-4.5-1.851-4.5" fill="#fff"/>
                </svg>
                Support my work on Ko-fi!
            </a></p>
        </footer>
    </div>

    <!-- Modal pour liens externes -->
    <div id="popup-container" class="popup-container hidden">
        <div class="popup" role="dialog" aria-modal="true" tabindex="-1">
            <h2>Ouvrir le lien ?</h2>
            <p class="popup-url"></p>
            <div class="popup-buttons">
                <button class="btn-cancel" id="cancel">Annuler</button>
                <button class="btn-same-tab" id="same-tab">Cet onglet</button>
                <button class="btn-new-tab" id="new-tab">Nouvel onglet</button>
            </div>
        </div>
    </div>

    <!-- Load modules and initialize -->
    <script type="module" src="app-modular.js"></script>
</body>
</html>